<div fxLayout="column" fxFlexFill>
    <mat-sidenav-container fxFlex>
        <mat-sidenav
            opened
            [mode]="bpObserver.isMatched(Breakpoints.Handset) ? 'over' : 'side'"
            autoFocus="dialog"
            #sidenav
            role="navigation"
        >
            <mat-nav-list>
                <a mat-list-item routerLink="/home">
                    <mat-icon matListItemIcon svgIcon="firemusic"></mat-icon>
                    Fire music
                </a>
                <mat-divider></mat-divider>

                <a mat-list-item routerLink="/search">
                    <mat-icon matListItemIcon>search</mat-icon>
                    Search
                </a>

                <a mat-list-item routerLink="/three">
                    <mat-icon matListItemIcon>3d_rotation</mat-icon>
                    Visualize
                </a>

                <a
                    mat-list-item
                    routerLink="/dashboard"
                    *ngIf="authService.isLoggedIn"
                    ><mat-icon matListItemIcon>dashboard</mat-icon>
                    Dashboard
                </a>

                <div style="position: absolute; bottom: 0; right: 0; left: 0">
                    <mat-divider></mat-divider>
                    <ng-container *ngIf="!authService.isLoggedIn; else profile">
                        <mat-list-item routerLink="/sign-in">
                            <mat-icon matListItemIcon>login</mat-icon>
                            <h3 matListItemTitle>Sign in</h3>
                        </mat-list-item>
                        <mat-list-item routerLink="/sign-up">
                            <mat-icon matListItemIcon>person_add</mat-icon>
                            <h3 matListItemTitle>Sign up</h3>
                        </mat-list-item>
                    </ng-container>
                </div>

                <ng-template #profile>
                    <a mat-list-item routerLink="/profile">
                        <mat-icon matListItemIcon>account_circle</mat-icon>
                        Profile
                    </a>
                    <a mat-list-item (click)="authService.signOut()">
                        <mat-icon matListItemIcon>exit_to_app</mat-icon>
                        Sign out
                    </a>
                </ng-template>
            </mat-nav-list>
        </mat-sidenav>
        <mat-sidenav-content fxFlex fxLayout="column">
            <mat-toolbar color="primary">
                <ng-container *ngIf="!search; else showSearch">
                    <div fxFlex fxLayout>
                        <button mat-icon-button (click)="sidenav.toggle()">
                            <mat-icon>menu</mat-icon>
                        </button>
                    </div>

                    <div fxFlex fxLayout="column" fxLayoutAlign="center center">
                        <button
                            fxFlex
                            class="icon-container"
                            mat-icon-button
                            routerLink="/home"
                        >
                            <mat-icon svgIcon="firemusic"></mat-icon>
                        </button>
                    </div>

                    <div fxFlex fxLayout fxLayoutAlign="end">
                        <button mat-icon-button (click)="search = true">
                            <mat-icon>search</mat-icon>
                        </button>
                    </div>
                </ng-container>
                <ng-template #showSearch>
                    <mat-form-field fxFlex fxFlexFill subscriptSizing="dynamic">
                        <input
                            matInput
                            #searchInput
                            type="text"
                            (change)="
                                router.navigate(['search'], {
                                    queryParams: {
                                        query: searchInput.value
                                    }
                                })
                            "
                            (focusout)="search = false"
                        />
                        <button
                            matIconSuffix
                            mat-icon-button
                            (click)="search = false"
                        >
                            <mat-icon>cancel</mat-icon>
                        </button>
                    </mat-form-field>
                </ng-template>
            </mat-toolbar>
            <div fxFlex>
                <router-outlet style="display: none"></router-outlet>
            </div>
        </mat-sidenav-content>
    </mat-sidenav-container>
    <app-music-player />
</div>
